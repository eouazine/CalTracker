<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <title>EliasCalTracker – Compteur v2.0/titre</title>

  <!-- Meta-tags PWA -->
  <meta name="description" content="Application de suivi des calories et protéines" />
  <meta name="theme-color" content="#49b36b" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="CalTracker" />
  <meta name="msapplication-TileColor" content="#49b36b" />
  <meta name="msapplication-tap-highlight" content="no" />

  <!-- Lien canonical pour GitHub Pages -->
  <link rel="canonical" href="https://eouazine.github.io/CalTracker/" />

  <!-- PWA Manifest : chemin absolu -->
  <link rel="manifest" href="/CalTracker/manifest.json" />

  <!-- Icônes de l’appli (chemins préfixés) -->
  <link rel="icon" type="image/jpeg" sizes="192x192" href="/CalTracker/icon.jpg" />
  <link rel="icon" type="image/jpeg" sizes="512x512" href="/CalTracker/icon.jpg" />
  <link rel="apple-touch-icon" href="/CalTracker/icon.jpg" />

  <!-- Votre CSS (inchangé) -->
  <style>
    /* … l’intégralité de votre feuille de styles telle qu’elle apparaît dans index.html … */
    /* Les variables CSS, les classes .container, .header, .counter, .card, etc. restent identiques */
  </style>
</head>
<body>
  <div class="container">
    <!-- … tout le contenu HTML de votre compteur, boutons, formulaires, etc., reste identique … -->
  </div>

  <!-- Modal d’erreur … -->
  <!-- … le reste de votre structure (modales, formulaires, etc.) reste inchangé … -->

  <!-- Bouton flottant pour ajouter un aliment … -->

  <!-- PWA Service Worker Registration — OPTIMISÉ POUR iPHONE -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        // Enregistrement avec chemin absolu et portée correcte
        navigator.serviceWorker.register('/CalTracker/sw.js', { scope: '/CalTracker/' })
          .then((registration) => {
            console.log('✅ Service Worker enregistré avec scope :', registration.scope);

            // Gestion des mises à jour pour iPhone
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              newWorker.addEventListener('statechange', () => {
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  console.log('📱 Nouveau Service Worker en attente : activation forcée');
                  newWorker.postMessage({ type: 'SKIP_WAITING' });
                }
              });
            });
          })
          .catch((error) => {
            console.error('❌ Erreur enregistrement Service Worker', error);
          });
      });
    }
  </script>

  <!-- Scripts de votre application (app-clean.js, database.js, etc.) -->
  <script src="app-clean.js"></script>
  <script src="database.js"></script>
  <script src="config.js"></script>
</body>
</html>
