<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <title>EliasCalTracker â€“ Compteur v2.0/titre</title>

  <!-- Meta-tags PWA -->
  <meta name="description" content="Application de suivi des calories et protÃ©ines" />
  <meta name="theme-color" content="#49b36b" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="CalTracker" />
  <meta name="msapplication-TileColor" content="#49b36b" />
  <meta name="msapplication-tap-highlight" content="no" />

  <!-- Lien canonical pour GitHub Pages -->
  <link rel="canonical" href="https://eouazine.github.io/CalTracker/" />

  <!-- PWA Manifest : chemin absolu -->
  <link rel="manifest" href="/CalTracker/manifest.json" />

  <!-- IcÃ´nes de lâ€™appli (chemins prÃ©fixÃ©s) -->
  <link rel="icon" type="image/jpeg" sizes="192x192" href="/CalTracker/icon.jpg" />
  <link rel="icon" type="image/jpeg" sizes="512x512" href="/CalTracker/icon.jpg" />
  <link rel="apple-touch-icon" href="/CalTracker/icon.jpg" />

  <!-- Votre CSS (inchangÃ©) -->
  <style>
    /* â€¦ lâ€™intÃ©gralitÃ© de votre feuille de styles telle quâ€™elle apparaÃ®t dans index.html â€¦ */
    /* Les variables CSS, les classes .container, .header, .counter, .card, etc. restent identiques */
  </style>
</head>
<body>
  <div class="container">
    <!-- â€¦ tout le contenu HTML de votre compteur, boutons, formulaires, etc., reste identique â€¦ -->
  </div>

  <!-- Modal dâ€™erreur â€¦ -->
  <!-- â€¦ le reste de votre structure (modales, formulaires, etc.) reste inchangÃ© â€¦ -->

  <!-- Bouton flottant pour ajouter un aliment â€¦ -->

  <!-- PWA Service Worker Registration â€” OPTIMISÃ‰ POUR iPHONE -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        // Enregistrement avec chemin absolu et portÃ©e correcte
        navigator.serviceWorker.register('/CalTracker/sw.js', { scope: '/CalTracker/' })
          .then((registration) => {
            console.log('âœ… Service Worker enregistrÃ© avec scopeÂ :', registration.scope);

            // Gestion des mises Ã  jour pour iPhone
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              newWorker.addEventListener('statechange', () => {
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  console.log('ğŸ“± Nouveau ServiceÂ Worker en attenteÂ : activation forcÃ©e');
                  newWorker.postMessage({ type: 'SKIP_WAITING' });
                }
              });
            });
          })
          .catch((error) => {
            console.error('âŒ Erreur enregistrement ServiceÂ Worker', error);
          });
      });
    }
  </script>

  <!-- Scripts de votre application (app-clean.js, database.js, etc.) -->
  <script src="app-clean.js"></script>
  <script src="database.js"></script>
  <script src="config.js"></script>
</body>
</html>
