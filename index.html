<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
    <title>EliasCalTracker ‚Äî Compteur v2.0</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Application de suivi des calories et prot√©ines" />
    <meta name="theme-color" content="#49b36b" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="CalTracker" />
    <meta name="msapplication-TileColor" content="#49b36b" />
    <meta name="msapplication-tap-highlight" content="no" />
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json" />
    
    <!-- PWA Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png" />
    <link rel="apple-touch-icon" href="icon-192.png" />
    
    <style>
      /* CSS complet int√©gr√© pour √©viter les probl√®mes de chargement */
      :root {
        --bg: #0f1216;
        --surface: #151a21;
        --muted: #99a2b2;
        --text: #e8edf5;
        --accent: #49b36b;
        --accent-weak: #2d7a46;
        --danger: #d45050;
        --danger-weak: #853636;
        --border: #232a35;
        
        /* Mobile optimizations */
        --mobile-padding: 16px;
        --mobile-gap: 12px;
        --mobile-font-size: 14px;
        --mobile-touch-target: 44px;
      }

      * { 
        box-sizing: border-box; 
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }
      html, body { 
        height: 100%; 
        overflow-x: hidden; /* Enlever la scrollbar horizontale */
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, 'Helvetica Neue', Arial, 'Apple Color Emoji', 'Segoe UI Emoji';
        background: var(--bg);
        color: var(--text);
        font-size: var(--mobile-font-size);
        -webkit-text-size-adjust: 100%;
        -webkit-tap-highlight-color: transparent;
      }

      .container {
        max-width: 840px;
        margin: 0 auto;
        padding: var(--mobile-padding);
        padding-bottom: 80px; /* Space for FAB */
        width: 100%;
        overflow-x: hidden;
      }

      /* Mobile-specific container adjustments */
      @media (max-width: 480px) {
        .container {
          padding: 12px;
          padding-bottom: 80px;
        }
      }

      .header { margin-bottom: 16px; }
      .app-title { margin: 0 0 4px; font-size: 24px; font-weight: 700; }
      .subtitle { margin: 0; color: var(--muted); }

      .card {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 16px;
        margin: 12px 0;
      }

      /* Mobile card adjustments */
      @media (max-width: 480px) {
        .card {
          padding: 12px;
          margin: 8px 0;
          border-radius: 8px;
        }
      }

      .section-title {
        margin: 0 0 14px;
        font-size: 20px;
        font-weight: 900;
        letter-spacing: 0.3px;
        background: linear-gradient(90deg, #ffd27a 0%, #a28bff 50%, #6fd6ff 100%);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        text-shadow: 0 2px 12px rgba(162,139,255,0.25), 0 2px 18px rgba(111,214,255,0.18);
      }
      .section-title::after { content: none; }

      .row { display: flex; }
      .row-center { align-items: center; }
      .gap { gap: 12px; }
      .spacer { flex: 1; }

      .metric { text-align: left; }
      .metric-value { font-size: 36px; font-weight: 800; line-height: 1; }
      .metric-label { color: var(--muted); margin-top: 4px; }

      .metric-block { text-align: center; padding: 8px; }
      .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; align-items: start; }

      /* Single counter layout */
      .single-counter { padding: 48px 24px; }
      .counter-header { margin: 20px 0 24px; text-align: center; }
      .counter-header .app-title {
        margin: 0 0 4px;
        font-size: 40px;
        font-weight: 900;
        letter-spacing: 0.3px;
        background: linear-gradient(90deg, #ffd27a 0%, #a28bff 50%, #6fd6ff 100%);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        text-shadow: 0 2px 12px rgba(162,139,255,0.25), 0 2px 18px rgba(111,214,255,0.18);
      }
      .counter-header .app-title::after { content: none; }
      .counter-header .app-date::after {
        content: '';
        display: block;
        width: 120px;
        height: 2px;
        margin: 8px auto 0;
        background: linear-gradient(90deg, transparent, #a28bff, transparent);
        border-radius: 2px;
      }
      .counter-header .subtitle { margin: 6px 0 0; color: var(--muted); opacity: 0.9; font-size: 13px; }
      .counter-header .app-date {
        margin-top: 6px;
        font-size: 16px;
        font-weight: 800;
        letter-spacing: 0.2px;
        background: linear-gradient(90deg, #a28bff 0%, #6fd6ff 100%);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
      }
      .single-row { 
        display: flex; 
        align-items: center; 
        gap: 12px; 
        margin-top: 16px; 
        flex-wrap: wrap;
      }

      /* Mise en page pour aligner les compteurs et le bouton */
      .single-counter .single-row {
        justify-content: flex-start;
        flex-wrap: nowrap;
      }

      .single-counter .single-actions {
        margin-left: auto;
        flex-shrink: 0;
      }

      /* Ligne s√©par√©e pour le bouton */
      .button-row {
        display: flex;
        justify-content: center;
        margin-top: 24px;
        position: relative;
      }
      .single-emoji { font-size: 36px; line-height: 1; opacity: 0.95; }
      .single-emoji { width: 40px; text-align: center; }
      .emoji-cal { filter: drop-shadow(0 1px 8px rgba(255,180,40,0.22)); }
      .single-emoji.badge {
        background: rgba(255,255,255,0.04);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 4px 0;
      }
      .single-emoji.small { font-size: 36px; }
      .single-value {
        font-size: 32px;
        font-weight: 800;
        letter-spacing: 0.25px;
        color: var(--text);
        background: linear-gradient(180deg, #121821 0%, #0f141a 100%);
        border: 1px solid #2a3240;
        padding: 6px 12px;
        border-radius: 12px;
        box-shadow: inset 0 1px 0 rgba(255,255,255,0.04), 0 1px 8px rgba(0,0,0,0.25);
        font-variant-numeric: tabular-nums;
      }
      .single-value.accent-cal {
        background: linear-gradient(180deg, #0f2d1a 0%, #0a1a0f 100%);
        border-color: #49b36b;
        box-shadow: inset 0 1px 0 rgba(255,255,255,0.03), 0 1px 10px rgba(73,179,107,0.18);
        color: #49b36b;
      }
      .single-value.small {
        font-size: 32px;
        padding: 6px 12px;
        border-radius: 12px;
      }

      /* Warning styles for negative values */
      .single-value.warning {
        background: linear-gradient(180deg, #2d1a0f 0%, #1a0f08 100%);
        border-color: #d45050;
        box-shadow: inset 0 1px 0 rgba(255,255,255,0.03), 0 1px 10px rgba(212,80,80,0.25);
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 14px;
      }

      .warning-icon {
        font-size: 24px;
        line-height: 1;
        animation: pulse 2s infinite;
      }

      .excess-value {
        font-size: 44px;
        font-weight: 800;
        color: #ff6b6b;
        line-height: 1;
      }

      .single-value.warning.small {
        padding: 6px 12px;
      }

      .single-value.warning.small .warning-icon {
        font-size: 18px;
      }

      .single-value.warning.small .excess-value {
        font-size: 24px;
      }

      /* Success styles for negative protein values */
      .single-value.success {
        background: linear-gradient(180deg, #0f2d1a 0%, #0a1a0f 100%);
        border-color: #49b36b;
        box-shadow: inset 0 1px 0 rgba(255,255,255,0.03), 0 1px 10px rgba(73,179,107,0.25);
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 14px;
      }

      .success-icon {
        font-size: 24px;
        line-height: 1;
        color: #6fd6ff;
        animation: pulse 2s infinite;
      }

      .single-value.success.small {
        padding: 6px 12px;
      }

      .single-value.success.small .success-icon {
        font-size: 18px;
      }

      .single-value.success.small .excess-value {
        font-size: 24px;
        color: #49b36b;
      }

      .normal-value {
        font-size: 24px;
        font-weight: 800;
        color: #49b36b;
        line-height: 1;
      }

      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
      }
      .single-label { color: var(--muted); font-weight: 600; opacity: 0.9; }
      .label-chip {
        background: rgba(255,255,255,0.04);
        border: 1px solid var(--border);
        border-radius: 999px;
        padding: 4px 10px;
      }
      .chip-cal {
        background: rgba(73, 179, 107, 0.08);
        border-color: rgba(73, 179, 107, 0.35);
        color: #49b36b;
      }

      .chip-cal.warning {
        background: rgba(212, 80, 80, 0.08);
        border-color: rgba(212, 80, 80, 0.35);
        color: #ff6b6b;
      }

      .label-chip.chip-prot.success {
        background: rgba(73, 179, 107, 0.08);
        border-color: rgba(73, 179, 107, 0.35);
        color: #49b36b;
      }

      .label-chip.chip-prot.warning {
        background: rgba(212, 80, 80, 0.08);
        border-color: rgba(212, 80, 80, 0.35);
        color: #ff6b6b;
      }
      .single-actions { position: relative; }
      .menu { position: absolute; right: 0; top: 42px; width: 260px; max-width: calc(100vw - 32px); background: #0f141a; border: 1px solid var(--border); border-radius: 10px; padding: 8px; display: none; box-shadow: 0 10px 30px rgba(0,0,0,0.35); backdrop-filter: blur(8px); }
      .menu[aria-hidden="false"] { display: block; }
      .menu-item { width: 100%; text-align: left; background: transparent; color: var(--text); border: 1px solid var(--border); padding: 8px 10px; border-radius: 8px; cursor: pointer; }
      .menu-item + .menu-item { margin-top: 6px; }
      .menu-item.danger { color: #ffd6d6; border-color: #5e2626; background: var(--danger-weak); }
      .menu-sep { height: 8px; }

      .btn-group { display: flex; gap: 8px; flex-wrap: wrap; }
      .btn-group.column { flex-direction: column; }
      .btn-group.compact .btn { padding: 6px 8px; }

      .btn {
        background: var(--accent-weak);
        color: #eafff1;
        border: 1px solid #2a5f3d;
        padding: 6px 10px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        min-height: var(--mobile-touch-target);
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
      }
      .btn:hover { filter: brightness(1.05); }
      .btn:active { transform: translateY(1px); }

      /* Mobile button optimizations */
      @media (max-width: 480px) {
        .btn {
          padding: 12px 16px;
          font-size: 16px;
          min-height: 48px;
        }
      }
      .btn.ghost { background: transparent; color: var(--muted); border-color: var(--border); }
      .btn.danger { background: var(--danger-weak); border-color: #5e2626; color: #ffecec; }

      .btn-adjust {
        background: linear-gradient(180deg, #2a2566 0%, #201c56 100%);
        color: #e6e5ff;
        border: 1px solid #3d38a3;
        border-radius: 999px;
        padding: 12px 24px;
        font-size: 16px;
        box-shadow: 0 3px 14px rgba(68, 64, 178, 0.35), inset 0 1px 0 rgba(255,255,255,0.07);
        min-height: 48px;
        font-weight: 600;
      }

      .btn-ghost {
        background: transparent;
        color: var(--text);
        border: 1px solid var(--border);
        border-radius: 999px;
        padding: 8px 16px;
        box-shadow: none;
        transition: all 0.2s ease;
      }

      .btn-ghost:hover {
        background: rgba(255, 255, 255, 0.05);
        border-color: var(--accent);
        color: var(--accent);
      }
      .btn-adjust:hover { filter: brightness(1.06); box-shadow: 0 5px 18px rgba(68,64,178,0.45), inset 0 1px 0 rgba(255,255,255,0.08); }
      .btn-adjust:active { transform: translateY(1px); }

      /* Gradient buttons (match title colors) */
      .btn-gradient {
        background: linear-gradient(90deg, #ffd27a 0%, #a28bff 50%, #6fd6ff 100%);
        color: #0b0e13;
        border: 1px solid #3a3f66;
        font-weight: 800;
      }
      .btn-gradient:hover { filter: brightness(1.08); }

      /* Full-width helper */
      .btn-block { width: 100%; }

      /* Adjust menu full-width inputs */
      .menu .inline-input { width: 100%; }
      .menu .inline-input input { width: 100%; flex: 1; }

      /* Planning */
      .day-planning { padding-top: 12px; }
      .planning-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; }
      .planning-cell {
        background: #11161d;
        border: 1px dashed #2b3340;
        color: var(--text);
        border-radius: 12px;
        padding: 20px;
        text-align: left;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        min-height: 120px;
      }
      .planning-cell:hover { border-style: solid; filter: brightness(1.05); }
      .cell-title { font-weight: 800; font-size: 16px; color: var(--muted); margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; background: #11161d; padding-bottom: 8px; z-index: 1; }
      .cell-emoji { font-size: 20px; opacity: 0.95; }
      .cell-body { color: #c9d3e7; min-height: 24px; font-size: 16px; }

      @media (max-width: 720px) {
        .planning-row { grid-template-columns: repeat(2, 1fr); }
      }

      /* Search */
      .food-search { padding-top: 12px; }
      .search-row { display: flex; gap: 8px; align-items: center; }
      .search-input {
        flex: 1;
        background: #0f141a;
        color: var(--text);
        border: 1px solid var(--border);
        padding: 14px 16px;
        border-radius: 10px;
        font-size: 16px;
        -webkit-user-select: text;
        -moz-user-select: text;
        -ms-user-select: text;
        user-select: text;
      }
      .search-select { 
        background: #0f141a; 
        color: var(--text); 
        border: 1px solid var(--border); 
        padding: 14px 16px; 
        border-radius: 10px; 
        font-size: 16px; 
        -webkit-user-select: text;
        -moz-user-select: text;
        -ms-user-select: text;
        user-select: text;
      }
      .search-list { margin-top: 16px; display: grid; gap: 12px; }
      .search-item { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        background: #11161d; 
        border: 1px solid #2b3340; 
        border-radius: 10px; 
        padding: 16px 18px; 
        min-width: 0; /* Permet au contenu de se r√©tr√©cir */
        overflow: hidden; /* Cache le contenu qui d√©borde */
        min-height: 60px;
      }
      .search-item-name { 
        font-weight: 600; 
        flex: 1; 
        min-width: 0; 
        overflow: hidden; 
        text-overflow: ellipsis; 
        white-space: nowrap; 
        font-size: 16px;
      }
      .search-item-right { display: flex; align-items: center; gap: 12px; }
      .search-item-kcal { color: var(--muted); font-size: 16px; }
      .search-item-prot { color: #b0ffc7; font-size: 16px; }
      .search-item-right .sep { position: relative; padding-left: 12px; }
      .search-item-right .sep::before { content: ''; position: absolute; left: 0; top: 50%; transform: translateY(-50%); height: 14px; width: 1px; background: #2b3340; }
      .search-item-actions {
        display: flex;
        gap: 8px;
      }
      .search-edit, .search-remove { 
        background: transparent; 
        border: none; 
        padding: 8px 10px; 
        cursor: pointer; 
        font-size: 18px; 
        line-height: 1; 
        border-radius: 6px;
        transition: all 0.2s ease;
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .search-edit {
        color: var(--accent);
      }
      .search-edit:hover { 
        color: #6fd6ff; 
        background: rgba(111,214,255,0.1);
      }
      .search-remove {
        color: #ff4d4d;
        font-size: 18px;
        font-weight: bold;
      }
      .search-remove:hover { 
        color: #ff7777; 
        background: rgba(255,77,77,0.1);
      }

      /* Drag & drop */
      .search-item[draggable="true"] { cursor: grab; }
      .search-item[draggable="true"]:active { cursor: grabbing; }
      .planning-cell.drop-target { border-color: #5671ff; box-shadow: 0 0 0 2px rgba(86,113,255,0.25) inset; }
      .cell-chips { display: grid; gap: 10px; }
      .chip { 
        display: flex; 
        flex-direction: column;
        width: 100%; 
        background: #1a1a2e; 
        border: 1px solid #2a3240; 
        border-radius: 8px; 
        padding: 12px; 
        font-size: 14px; 
        position: relative;
        min-width: 0;
        overflow: hidden;
        box-shadow: 0 1px 3px rgba(0,0,0,0.3);
      }
      .chip-content {
        display: flex;
        flex-direction: column;
        width: 100%;
      }
      .chip-name {
        font-weight: 500;
        color: #c9d3e7;
        margin-bottom: 6px;
        font-size: 13px;
      }
      .chip-quantity {
        font-size: 11px;
        color: #6fd6ff;
        margin-bottom: 8px;
        font-weight: 500;
      }
      .chip-nutrition {
        display: flex;
        gap: 16px;
        font-size: 11px;
        margin-bottom: 8px;
      }
      .chip-calories {
        color: #c9d3e7;
        font-weight: 600;
      }
      .chip-proteins {
        color: #c9d3e7;
        font-weight: 600;
      }
      .chip-actions {
        display: flex;
        gap: 8px;
        justify-content: center;
        margin-top: 8px;
        width: 100%;
        flex-shrink: 0;
      }
      .chip-edit, .chip-delete {
        background: transparent;
        border: none;
        padding: 8px 10px;
        cursor: pointer;
        font-size: 16px;
        line-height: 1;
        border-radius: 6px;
        transition: all 0.2s ease;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .chip-edit {
        color: #6fd6ff;
      }
      .chip-edit:hover {
        color: #8fe6ff;
        background: rgba(111,214,255,0.1);
      }
      .chip-delete {
        color: #ff4d4d;
        font-size: 18px;
        font-weight: bold;
      }
      .chip-delete:hover {
        color: #ff7777;
        background: rgba(255,77,77,0.1);
      }
      .nutrition-sep { opacity: 0.6; }

      /* Modal */
      .modal::backdrop { 
        background: rgba(0, 0, 0, 0.85); 
        backdrop-filter: blur(8px);
      }
      .modal { 
        border: none; 
        padding: 0; 
        border-radius: 12px; 
        background: transparent; 
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 2000;
        padding: 16px;
      }
      .modal[open] {
        display: flex;
      }
      .modal-content { background: #0f141a; color: var(--text); border: 1px solid var(--border); border-radius: 14px; padding: 32px; min-width: 400px; max-width: calc(100vw - 32px); box-shadow: 0 20px 60px rgba(0,0,0,0.65); }
      .modal-title { margin: 0 0 20px; font-size: 22px; font-weight: 600; }
      .modal-field { display: grid; gap: 8px; margin: 16px 0; }
      .modal-field input { 
        background: #0f141a; 
        color: var(--text); 
        border: 1px solid var(--border); 
        border-radius: 8px; 
        padding: 12px 14px; 
        font-size: 16px; 
        -webkit-user-select: text;
        -moz-user-select: text;
        -ms-user-select: text;
        user-select: text;
      }
      .modal-actions { display: flex; justify-content: flex-end; gap: 12px; margin-top: 20px; }

      /* Tabs */
      .tabs { display: inline-flex; gap: 6px; background: rgba(255,255,255,0.04); border: 1px solid #2a3240; border-radius: 10px; padding: 4px; margin-bottom: 10px; }
      .tab { background: transparent; color: var(--text); border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-size: 16px; }
      .tab.active { background: #0f141a; border: 1px solid #2a3240; }
      .tab-panel { display: none; }
      .tab-panel.active { display: block; }
      .muted { color: var(--muted); }
      .modal-field select { 
        background: #0f141a; 
        color: var(--text); 
        border: 1px solid var(--border); 
        border-radius: 8px; 
        padding: 12px 14px; 
        font-size: 16px; 
        -webkit-user-select: text;
        -moz-user-select: text;
        -ms-user-select: text;
        user-select: text;
      }

      .inline-input { display: flex; gap: 8px; align-items: center; margin-top: 8px; }
      input[type="number"] {
        background: #0f141a;
        color: var(--text);
        border: 1px solid var(--border);
        padding: 8px 10px;
        border-radius: 8px;
        width: 160px;
      }
      /* Remove number spinners */
      input[type="number"]::-webkit-outer-spin-button,
      input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
      input[type="number"] { -moz-appearance: textfield; }

      .hint { color: var(--muted); margin-top: 6px; }

      .footer { margin-top: 20px; text-align: center; color: var(--muted); }
      .bottom-info { margin: 8px 0 0; text-align: center; color: var(--muted); font-weight: 600; }

      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      @media (max-width: 720px) {
        .grid-3 { grid-template-columns: 1fr; }
        .metric-value { font-size: 32px; }
        .single-value { font-size: 28px; }
        .single-emoji { font-size: 36px; }
      }

      /* Floating Add Button */
      .fab {
        position: fixed;
        right: 20px;
        bottom: 20px;
        width: 56px;
        height: 56px;
        border-radius: 50%;
        background: linear-gradient(180deg, #2a2566 0%, #201c56 100%);
        color: #e6e5ff;
        border: 1px solid #3d38a3;
        box-shadow: 0 8px 24px rgba(68,64,178,0.4);
        font-size: 28px;
        font-weight: 800;
        line-height: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        -webkit-tap-highlight-color: transparent;
        transition: all 0.2s ease;
      }

      /* Mobile FAB adjustments */
      @media (max-width: 480px) {
        .fab {
          right: 16px;
          bottom: 16px;
          width: 60px;
          height: 60px;
          font-size: 32px;
        }
      }

      /* iPhone 12/14 specific optimizations */
      @media (max-width: 428px) {
        .container {
          padding: 8px;
          padding-bottom: 80px;
        }
        
        .card {
          padding: 10px;
          margin: 6px 0;
        }
        
        .app-title {
          font-size: 20px;
        }
        
        .section-title {
          font-size: 18px;
        }
        
        .single-value {
          font-size: 24px;
          padding: 4px 8px;
        }
        
        .single-emoji {
          font-size: 28px;
          width: 32px;
        }
        
        /* R√©duire les largeurs fixes sur mobile */
        .menu {
          width: 200px;
          max-width: calc(100vw - 16px);
        }
        
        .modal-content {
          min-width: 320px;
          max-width: calc(100vw - 16px);
          padding: 24px;
        }
        
        .search-item {
          padding: 12px;
          min-height: 50px;
        }
        
        .search-item-name {
          font-size: 15px;
        }
        
        .btn-adjust {
          padding: 10px 20px;
          font-size: 14px;
          min-height: 44px;
        }
        
        .chip {
          padding: 12px;
        }
        
        .chip-name {
          font-size: 16px;
        }
        
        .chip-quantity {
          font-size: 14px;
        }
        
        .chip-nutrition {
          font-size: 13px;
        }
        
        .chip-actions {
          margin-top: 10px;
        }
        
        .chip-edit, .chip-remove {
          width: 40px;
          height: 40px;
          font-size: 16px;
          padding: 10px 12px;
        }
        
        .chip-remove {
          font-size: 18px;
        }
        
        .search-edit, .search-remove {
          width: 32px;
          height: 32px;
          font-size: 16px;
          padding: 6px 8px;
        }
        
        .search-remove {
          font-size: 16px;
        }
      }

      /* Styles pour le scanner de code-barres */
      .scanner-container {
        position: relative;
        width: 100%;
        height: 300px;
        background: #000;
        border-radius: 12px;
        overflow: hidden;
        margin: 16px 0;
      }

      #scanner-area {
        width: 100%;
        height: 100%;
      }

      .scanner-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 10;
      }

      .scanner-frame {
        width: 200px;
        height: 100px;
        border: 2px solid #00ff00;
        border-radius: 8px;
        position: relative;
        animation: scanner-pulse 2s infinite;
      }

      .scanner-frame::before,
      .scanner-frame::after {
        content: '';
        position: absolute;
        background: #00ff00;
      }

      .scanner-frame::before {
        top: -2px;
        left: -2px;
        width: 20px;
        height: 20px;
        border-top: 3px solid #00ff00;
        border-left: 3px solid #00ff00;
      }

      .scanner-frame::after {
        bottom: -2px;
        right: -2px;
        width: 20px;
        height: 20px;
        border-bottom: 3px solid #00ff00;
        border-right: 3px solid #00ff00;
      }

      @keyframes scanner-pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
      }

      .scanner-instructions {
        color: white;
        text-align: center;
        margin-top: 20px;
        font-size: 16px;
        font-weight: 500;
        text-shadow: 0 1px 3px rgba(0,0,0,0.5);
      }

      .scanner-results {
        margin: 16px 0;
        padding: 16px;
        background: rgba(255,255,255,0.05);
        border-radius: 8px;
        border: 1px solid var(--border);
      }

      .scanner-results h4 {
        margin: 0 0 12px;
        color: var(--accent);
        font-size: 16px;
      }

      .scanner-actions {
        display: flex;
        gap: 12px;
        justify-content: space-between;
        margin-top: 16px;
      }

      #scanned-food-info {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        margin-top: 12px;
      }

      .scanned-food-item {
        padding: 8px;
        background: rgba(255,255,255,0.03);
        border-radius: 6px;
        text-align: center;
      }

      .scanned-food-item strong {
        display: block;
        color: var(--accent);
        font-size: 14px;
        margin-bottom: 4px;
      }

      .scanned-food-item span {
        color: var(--text);
        font-size: 16px;
        font-weight: 600;
      }

      /* Responsive pour le scanner */
      @media (max-width: 428px) {
        .scanner-container {
          height: 250px;
        }
        
        .scanner-frame {
          width: 160px;
          height: 80px;
        }
        
        .scanner-instructions {
          font-size: 14px;
          margin-top: 16px;
        }
        
        .scanner-actions {
          flex-direction: column;
        }
        
        #scanned-food-info {
          grid-template-columns: 1fr;
        }
      }

      /* Pr√©venir le d√©bordement horizontal */
      * {
        max-width: 100%;
        box-sizing: border-box;
      }

      /* S'assurer que les √©l√©ments flexibles ne d√©bordent pas */
      .flex, .flex-row, .flex-column {
        min-width: 0;
      }

      /* Forcer tous les √©l√©ments √† respecter la largeur de l'√©cran */
      body, html {
        max-width: 100vw;
        overflow-x: hidden;
      }

      /* S'assurer que les grilles ne d√©bordent pas */
      .grid, .planning-row, .cell-chips {
        max-width: 100%;
        overflow: hidden;
      }
      .fab:hover { filter: brightness(1.06); box-shadow: 0 10px 28px rgba(68,64,178,0.5); }
      .fab:active { transform: translateY(1px); }

      /* Quantity Modal Styles */
      .quantity-info {
        background: rgba(255,255,255,0.04);
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 12px;
        margin-bottom: 16px;
        text-align: center;
      }

      .food-name {
        font-size: 18px;
        font-weight: 700;
        color: var(--text);
        margin-bottom: 4px;
      }

      .food-nutrition {
        color: var(--muted);
        font-size: 14px;
      }

      .quantity-preview {
        background: rgba(255,255,255,0.02);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 12px;
        margin: 12px 0;
        display: grid;
        gap: 8px;
      }

      .preview-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .preview-label {
        color: var(--muted);
        font-weight: 600;
      }

      .preview-value {
        color: var(--accent);
        font-weight: 700;
        font-size: 16px;
      }

      .modal-actions {
        display: flex;
        gap: 12px;
        margin-top: 16px;
        justify-content: flex-end;
      }

      .modal-actions .btn {
        flex: 0 0 auto;
        min-width: 140px;
        padding: 12px 20px;
        font-size: 16px;
      }
    </style>
  </head>
  <body>
    <main class="container">
      

      <section class="card single-counter" aria-labelledby="counter-title">
        <h2 id="counter-title" class="sr-only">Compteur</h2>
        <div class="counter-header">
          <h1 class="app-title">Elias Calories Tracker</h1>
          <div id="appDate" class="app-date subtitle"></div>
          <p class="subtitle">&nbsp;</p>
        </div>
        <div class="single-row">
          <div class="single-emoji emoji-cal" aria-hidden="true">üî•</div>
          <div class="single-value accent-cal" id="counterValue">0</div>
          <div class="single-label label-chip chip-cal" aria-hidden="true">Calories restantes</div>
          <div class="spacer"></div>
          <div class="single-actions">
          </div>
        </div>

        <div class="single-row">
          <div class="single-emoji small" aria-hidden="true">üçó</div>
          <div class="single-value small" id="proteinValue">0</div>
          <div class="single-label label-chip" aria-hidden="true">Prot√©ines restantes</div>
          </div>
        
        <div class="button-row">
          <button id="adjustBtn" class="btn btn-adjust">Modifier les objectifs</button>
        </div>
      </section>

      <section class="card day-planning" aria-labelledby="planning-title">
        <h2 id="planning-title" class="section-title">Planning</h2>
        <div class="planning-row" role="list">
          <button class="planning-cell" role="listitem" aria-label="Matin" data-slot="morning">
            <div class="cell-title">Matin <span class="cell-emoji">üåÖ</span></div>
            <div class="cell-body"><div class="cell-chips"></div></div>
          </button>
          <button class="planning-cell" role="listitem" aria-label="Midi" data-slot="noon">
            <div class="cell-title">Midi <span class="cell-emoji">‚òÄÔ∏è</span></div>
            <div class="cell-body"><div class="cell-chips"></div></div>
          </button>
          <button class="planning-cell" role="listitem" aria-label="Go√ªter" data-slot="snack">
            <div class="cell-title">Go√ªter <span class="cell-emoji">üç™</span></div>
            <div class="cell-body"><div class="cell-chips"></div></div>
          </button>
          <button class="planning-cell" role="listitem" aria-label="Soir" data-slot="evening">
            <div class="cell-title">Soir <span class="cell-emoji">üåô</span></div>
            <div class="cell-body"><div class="cell-chips"></div></div>
          </button>
        </div>
      </section>

      <section class="card food-search" aria-labelledby="search-title">
        <h2 id="search-title" class="section-title">Rechercher</h2>
        <div class="search-row">
          <input id="foodQuery" class="search-input" type="text" placeholder="Rechercher un aliment..." aria-label="Rechercher un aliment" />
          <select id="foodCatFilter" class="search-select" aria-label="Filtrer par cat√©gorie">
            <option value="">Tout</option>
            <option value="fruit">Fruit</option>
            <option value="legume">L√©gume</option>
            <option value="viande">Viande</option>
            <option value="cereale">C√©r√©ale</option>
            <option value="laitier">Laitier</option>
            <option value="boisson">Boisson</option>
            <option value="autre">Autre</option>
          </select>
        </div>
        <div id="foodList" class="search-list" role="list"></div>
      </section>

      <dialog id="foodModal" class="modal">
        <form class="modal-content">
          <h3 class="modal-title">Cr√©er un aliment</h3>

          <div class="tabs">
            <button type="button" class="tab active" data-tab-target="#tabManual">Manuelle</button>
            <button type="button" class="tab" data-tab-target="#tabScan">Scan</button>
          </div>

          <div id="tabManual" class="tab-panel active">
            <label class="modal-field">
              <span>Nom</span>
              <input id="modalFoodName" type="text" placeholder="Ex: Poulet 100g" required />
            </label>
            <label class="modal-field">
              <span>Cat√©gorie</span>
              <select id="modalFoodCat">
                <option value="autre" selected>Autre</option>
                <option value="fruit">Fruit</option>
                <option value="legume">L√©gume</option>
                <option value="viande">Viande</option>
                <option value="cereale">C√©r√©ale</option>
                <option value="laitier">Laitier</option>
                <option value="boisson">Boisson</option>
              </select>
            </label>
            <label class="modal-field">
              <span>Kcal (pour 100 g)</span>
              <input id="modalFoodKcal" type="number" inputmode="numeric" min="0" step="1" placeholder="Ex: 165 / 100 g" />
            </label>
            <label class="modal-field">
              <span>Prot√©ines (g pour 100 g)</span>
              <input id="modalFoodProt" type="number" inputmode="numeric" min="0" step="1" placeholder="Ex: 31 g / 100 g" />
            </label>
          </div>

          <div id="tabScan" class="tab-panel">
            <div class="scanner-container">
              <div id="scanner-area"></div>
              <div class="scanner-overlay">
                <div class="scanner-frame"></div>
                <p class="scanner-instructions">Pointez la cam√©ra vers le code-barres</p>
              </div>
            </div>
            <div id="scanner-results" class="scanner-results" style="display: none;">
              <h4>R√©sultats du scan :</h4>
              <div id="scanned-food-info"></div>
            </div>
            <div class="scanner-actions">
              <button type="button" id="scan-toggle" class="btn btn-adjust">D√©marrer le scan</button>
              <button type="button" id="scan-cancel" class="btn btn-ghost">Annuler</button>
            </div>
          </div>

          <div class="modal-actions">
            <button type="button" id="modalFoodCancel" class="btn btn-ghost">Annuler</button>
            <button id="modalFoodSave" value="default" class="btn btn-adjust">Cr√©er l'aliment</button>
          </div>
        </form>
      </dialog>

      <dialog id="quantityModal" class="modal">
        <form class="modal-content">
          <h3 class="modal-title">Quantit√© consomm√©e</h3>
          
          <div class="quantity-info">
            <div class="food-name" id="quantityFoodName">Aliment</div>
            <div class="food-nutrition" id="quantityFoodNutrition">0 kcal ‚Ä¢ 0g prot / 100g</div>
          </div>

          <label class="modal-field">
            <span>Quantit√© en grammes</span>
            <input id="quantityInput" type="number" inputmode="numeric" min="1" step="1" placeholder="Ex: 150" value="100" />
          </label>

          <div class="quantity-preview" id="quantityPreview">
            <div class="preview-item">
              <span class="preview-label">Calories :</span>
              <span class="preview-value" id="previewKcal">0</span>
            </div>
            <div class="preview-item">
              <span class="preview-label">Prot√©ines :</span>
              <span class="preview-value" id="previewProt">0 g</span>
            </div>
          </div>

          <div class="modal-actions">
            <button type="button" id="quantityCancel" class="btn btn-ghost">Annuler</button>
            <button id="quantitySave" class="btn btn-adjust">Ajouter au planning</button>
          </div>
        </form>
      </dialog>

      <dialog id="editModal" class="modal">
        <form class="modal-content">
          <h3 class="modal-title">Modifier l'aliment</h3>

          <label class="modal-field">
            <span>Nom</span>
            <input id="editFoodName" type="text" placeholder="Ex: Poulet 100g" required />
          </label>
          <label class="modal-field">
            <span>Cat√©gorie</span>
            <select id="editFoodCat">
              <option value="autre" selected>Autre</option>
              <option value="fruit">Fruit</option>
              <option value="legume">L√©gume</option>
              <option value="viande">Viande</option>
              <option value="cereale">C√©r√©ale</option>
              <option value="laitier">Laitier</option>
              <option value="boisson">Boisson</option>
            </select>
          </label>
          <label class="modal-field">
            <span>Kcal (pour 100 g)</span>
            <input id="editFoodKcal" type="number" inputmode="numeric" min="0" max="10000" step="1" placeholder="Ex: 165 / 100 g" />
          </label>
          <label class="modal-field">
            <span>Prot√©ines (g pour 100 g)</span>
            <input id="editFoodProt" type="number" inputmode="numeric" min="0" max="10000" step="0.01" placeholder="Ex: 31 g / 100 g" />
          </label>

          <div class="modal-actions">
            <button type="button" id="editFoodCancel" class="btn btn-ghost">Annuler</button>
            <button id="editFoodSave" class="btn btn-adjust">Modifier l'aliment</button>
          </div>
        </form>
      </dialog>


      <dialog id="addFoodModal" class="modal">
        <form class="modal-content">
          <h3 class="modal-title">Ajouter un aliment - Tous les champs sont obligatoires</h3>
          
          <label class="modal-field">
            <span>Nom de l'aliment</span>
            <input id="addFoodName" type="text" placeholder="Ex: Pomme" />
          </label>
          <label class="modal-field">
            <span>Cat√©gorie</span>
            <select id="addFoodCat">
              <option value="autre" selected>Autre</option>
              <option value="fruit">Fruit</option>
              <option value="legume">L√©gume</option>
              <option value="viande">Viande</option>
              <option value="cereale">C√©r√©ale</option>
              <option value="laitier">Laitier</option>
              <option value="boisson">Boisson</option>
            </select>
          </label>
          <label class="modal-field">
            <span>Kcal (pour 100 g)</span>
            <input id="addFoodKcal" type="number" inputmode="numeric" pattern="[0-9]*" min="0" max="10000" step="1" placeholder="Ex: 165 (max 10000)" />
          </label>
          <label class="modal-field">
            <span>Prot√©ines (g pour 100 g)</span>
            <input id="addFoodProt" type="number" inputmode="numeric" pattern="[0-9]*\.?[0-9]*" min="0" max="10000" step="0.01" placeholder="Ex: 31 (max 10000)" />
          </label>

          <div class="modal-actions">
            <button type="button" id="addFoodCancel" class="btn btn-ghost">Annuler</button>
            <button id="addFoodSave" class="btn btn-adjust">Cr√©er l'aliment</button>
          </div>
        </form>
      </dialog>

      <dialog id="adjustModal" class="modal">
        <form class="modal-content">
          <h3 class="modal-title">Modifier les objectifs</h3>
          
          <label class="modal-field">
            <span>Calories par jour</span>
            <input id="counterInput" type="number" inputmode="numeric" min="0" step="10" placeholder="Ex: 3000" />
          </label>

          <label class="modal-field">
            <span>Prot√©ines par jour (g)</span>
            <input id="proteinInput" type="number" inputmode="numeric" min="0" step="5" placeholder="Ex: 150" />
          </label>

          <div class="modal-actions">
            <button type="button" id="adjustCancel" class="btn btn-ghost">Annuler</button>
            <button id="adjustApply" class="btn btn-adjust">Valider</button>
          </div>
        </form>
      </dialog>

      <!-- Modal d'erreur -->
      <dialog id="errorModal" class="modal">
        <div class="modal-content">
          <h3 id="errorTitle" class="modal-title">‚ö†Ô∏è Erreur</h3>
          
          <div class="modal-field">
            <div id="errorMessage" style="text-align: center; padding: 20px; font-size: 16px; line-height: 1.5;">
              <!-- Le message sera ins√©r√© ici -->
            </div>
          </div>

          <div class="modal-actions">
            <button type="button" id="errorClose" class="btn btn-adjust">OK</button>
          </div>
        </div>
      </dialog>

    </main>

    <button id="fabAdd" class="fab" aria-label="Ajouter un aliment">+</button>

    <!-- PWA Service Worker Registration - OPTIMIS√â POUR IPHONE -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('./sw.js', { scope: './' })
            .then((registration) => {
              console.log('‚úÖ Service Worker enregistr√© avec succ√®s:', registration.scope);
              
              // Gestion des mises √† jour pour iPhone
              registration.addEventListener('updatefound', () => {
                const newWorker = registration.installing;
                newWorker.addEventListener('statechange', () => {
                  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    console.log('üîÑ Nouveau Service Worker disponible');
                    // Forcer l'activation
                    newWorker.postMessage({ type: 'SKIP_WAITING' });
                  }
                });
              });
              
              // V√©rifier si c'est un iPhone
              const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
              if (isIOS) {
                console.log('üì± D√©tection iPhone - Optimisations PWA activ√©es');
                
                // Forcer le rechargement du cache
                if ('caches' in window) {
                  caches.keys().then(cacheNames => {
                    cacheNames.forEach(cacheName => {
                      if (cacheName.startsWith('caltracker-')) {
                        caches.delete(cacheName);
                        console.log('üóëÔ∏è Cache iPhone nettoy√©:', cacheName);
                      }
                    });
                  });
                }
              }
            })
            .catch((error) => {
              console.error('‚ùå √âchec Service Worker:', error);
              
              // Fallback pour iPhone en cas d'erreur
              const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
              if (isIOS) {
                console.log('üì± Mode fallback iPhone activ√©');
                // Recharger la page apr√®s 2 secondes
                setTimeout(() => {
                  window.location.reload();
                }, 2000);
              }
            });
        });
        
        // Gestion des erreurs de navigation PWA
        window.addEventListener('error', (event) => {
          if (event.target.tagName === 'IMG' || event.target.tagName === 'SCRIPT') {
            console.log('üîÑ Ressource manquante, rechargement...');
            setTimeout(() => {
              window.location.reload();
            }, 1000);
          }
        });
      }
    </script>
    <!-- Supabase -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <!-- BarcodeDetector API native + fallback ZXing -->
    <script src="https://unpkg.com/@zxing/library@latest/umd/index.min.js"></script>
    <!-- Configuration -->
    <script src="config.js"></script>
    <!-- Database -->
    <script src="database.js"></script>
    <!-- App -->
    <script src="app-clean.js?v=20"></script>
  </body>
  </html>


